---
title: 条件独立性检验
date: 2025-05-22 17:56:56
tags:
mathjax: true
---

<meta name="referrer" content="no-referrer" />


# 前言

本文记录一些条件独立性检验的核心思想。条件独立性检验根据不同假设分为多种，本文介绍的主要tigramite.independence_tests模块实现的条件独立性检验方法，
可以满足日常所用。检验方法适用条件如下：

| 方法           | 数据类型         | 依赖关系           | 核心假设           | 多变量支持 |
|----------------|----------------|--------------------|--------------------|------------|
| ParCorr        | 连续（单变量）  | 线性               | 高斯分布           | ❌         |
| RobustParCorr  | 连续（单变量）  | 线性               | 非高斯、抗离群点   | ❌         |
| ParCorrWLS     | 连续（单变量）  | 线性               | 异方差校正         | ❌         |
| GPDC           | 连续（单变量）  | 非线性（加性）     | 加性函数分解       | ❌         |
| CMIknn         | 连续（多变量）  | 任意               | 无参数假设         | ✅         |
| Gsquared       | 离散（单变量）  | 任意               | 列联表频数足够     | ❌         |
| CMIsymb        | 离散（多变量）  | 任意               | 离散符号化         | ✅         |
| RegressionCI   | 混合（单变量）  | 线性 / 广义线性    | 回归模型假设       | ❌         |

# 连续变量，线性依赖

在回归模型中，基于不同的概率假设，会导出不同的回归模型，这些回归模型又会变成不同的优化问题，主要有以下三类

## 1. **ParCorr (偏相关检验)**

偏相关检验指，在控制（剔除）某些变量的影响后，考察两个变量之间的线形关系。

具体做法是，首先用线性最小二乘回归（OLS），把控制变量Z对X和Y的影响"剥离"出去。然后看X和Y剩下的部分（残差）是否还相关（用皮尔逊相关检验）。即需要检验 $X \perp Y|Z$，步骤如下：

1）计算残差。

用 $Z$ 分别回归 $X$ 和 $Y$，得到残差（去掉 $Z$ 影响后 $X$ 和 $Y$ 的部分）。由于这步利用OLS，因此需要满足，

- 线性假设：参数线性。

- 同方差性：$Var(e)=\sigma^2 I$，若不成立，则估计量不是方差最小的估计量，即不是最优线性无偏估计量（BLUE）。

- 残差零均值假设，$E(e|X)=0$，若不成立，则OLS估计量有偏。

- 无自相关假设，$Cov(e_i, e_j)=0, (i\neq j)$, 若不成立，则OLS估计量仍然无偏，但方差估计不准导致假设检验失效。

- 解释变量外生性假设，$Cov(X, e)=0$，若不成立，则OLS估计量有偏。

- 解释变量满秩假设，$rank(X)=k+1$，若不成立，$X^T X$不可逆，OLS估计量无法计算。但是现实中常见的是多重共线性，不影响无偏性，但是会导致参数估计的方差增大，系数显著性降低。

- 误差项正态性假设（高斯-马尔可夫假设的拓展），误差项 $e \sim N(0, \sigma^2 I)$。非必要假设，主要用于假设检验，$X$ 是大样本即使误差项不满足正态分布，参数估计量也满足正态分布。

$$X = Z \beta_X + e_X$$

$$Y = Z \beta_Y + e_Y$$

$e_X$ 和 $e_Y$ 即为残差，对两个残差做皮尔森相关检验，看是否存在相关性。皮尔森相关系数为 $\rho_{(e_X, e_Y)}$。

2）皮尔逊相关系数显著性检验。

$H_0$: 没有线性相关关系

$H_1$: 存在线性相关关系

构造统计量 $t = \rho \sqrt{\frac{n-D_z-2}{1-\rho^2}} \sim t(N-D_Z-2)$，其中，$N$ 是样本数量，$D_Z$ 是控制变量数，这里是2。

## 2.  **RobustParCorr (鲁棒偏相关检验)**

RobustParCorr核心是采用鲁棒回归如huber回归，用于解决普通最小二乘法中对异常值敏感的问题。核心是通过混合损失函数平衡异常值影响。

损失函数数学表达式：

$$L_\delta(e)= \begin{cases}\frac{1}{2} e^2 & \text { 若 }|e| \leq \delta, \\ \delta|e|-\frac{1}{2} \delta^2 & \text { 若 }|e|>\delta .\end{cases}$$

其中，$e=y-\mathbf{x}^T \beta$ 为残差，$\delta>0$ 是控制鲁棒性的阈值参数。

- $\delta \rightarrow 0$ ：接近 L1 回归（完全鲁棒，但偏差大）；

- $\delta \rightarrow \infty$ ：退化为 OLS（对异常值敏感）。

步骤如下

1）利用交叉验证选择阈值 $\delta$，利用迭代加权最小二乘法（IRLS）求解参数，得到残差。

2）在得到新的残差 $e^{*}_X$ 和 $e^{*}_Y$ 后做皮尔森相关检验。

**迭代加权最小二乘**

IRLS通过将鲁棒回归问题转化为一系列加权最小二乘问题来求解，优化问题的定义为

$$\hat{\alpha} = argmin_{\alpha}\sum_{i=1}^N \rho(e_i), e_i = x_i^T \alpha - y_i$$

其中 $\rho$ 需要满足偶函数和连续可导，因为只有是偶函数才可以用最小二乘，只有连续可导才能求导数

具体步骤如下

1）计算权重函数

定义权重函数 $w(e)=\frac{\psi(e)}{e}, \psi(r)=\rho^{'}(e)$

对于huber回归，$w(e) = \begin{cases} 1 & |e| \leq \delta, \\ \frac{\delta}{|e|} & |e| > \delta. \end{cases}$

2）初始化参数

用普通最小二乘OLS计算初始估计 $\alpha^{(0)}=(X^TX)^{-1}X^T y, X=[x_1, ..., x_N]^T$

3）迭代更新

对于第 $k$ 次迭代：

- 计算残差 $e_i^{(k)} = x_i^T \alpha^{(k)} - y_i$

- 计算权重 $w_i^{(k)} = w(e_i^{(k)})$

- 加权最小二乘更新 $\alpha^{(k+1)}=(X^T W^{(k)} X)^{-1}X^TW^{(k)}y$, 其中 $W^{(k)}=diag(w_1^{(k)},..., w_N^{(k)})$

## 3. **ParCorrWLS (加权最小二乘偏相关系数)**

ParCorrWLS核心是采用加权最小二乘法求解，解决了样本的异方差性。当随着因变量的变化，残差的方差不是常数，此时数据不满足普通最小二乘法的假定，标准误估计不准确，进而影响系数的显著性判断，此时需要引入WLS。

步骤如下

1）选择权重。权重的选择取决于异方差模式。

若已知方差结构 $Var(e_i)=\sigma^2g(x_i)$, 取 $w_i=\frac{1}{g(x_i)}$. 

否则，可以采取两阶段估计，先用普通最小二乘估计，得到残差残差 $e_X$ 和 $e_Y$，每个样本 $i$ 都除以对应的残差 $e_i$，接着再做普通最小二乘估计得到参数估计量 $\hat{\beta}$

2）在得到新的残差 $e^{*}_X$ 和 $e^{*}_Y$ 后做皮尔森相关检验。

**加权最小二乘法**

若样本存在异常方差性，则有对于模型

$$y = X\beta + \epsilon$$

有 $E(\epsilon)=0, Cov(\epsilon, \epsilon^T)=\sigma^2W$，$W$ 是对角矩阵但不为单位矩阵

将 $W$ 分解为 $W=DD^T$，在原模型两侧分别左乘 $D^{-1}$, 得到新模型

$$D^{-1}y = D^{-1}X\beta + D^{-1}\epsilon$$

即

$$y^{*} = X^{*}\beta + \epsilon^{*}$$

此时 $Cov(\epsilon,\epsilon^T)=\sigma^2 I$，该模型的异方差性被消除了。接着可以用普通最小二乘法估计新模型，得到的参数估计为

$$\hat{\beta} = (X^{*T}X^{*})^{-1}X^{*T}y^{*} = (X^{*T}W^{-1}X^{*})^{-1}X^{*T}W^{-1}y$$

